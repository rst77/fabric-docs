

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using a Hardware Security Module (HSM) &mdash; hyperledger-fabricdocs master documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="hyperledger-fabricdocs master documentation" href="index.html"/>
        <link rel="up" title="Operations Guides" href="ops_guide.html"/>
        <link rel="next" title="Channel Configuration (configtx)" href="configtx.html"/>
        <link rel="prev" title="Membership Service Providers (MSP)" href="msp.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          


          
            <a href="index.html" class="icon icon-home"> hyperledger-fabricdocs
          

          
          </a>

          
            
            
              <div class="version">
                master
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

<br><img style="background-color: #fff; height: unset; width: unset;" alt="Hyperledger Fabric" src=_images/hyperledger_fabric_logo_color.png />
<br>
<a href="https://github.com/hyperledger/fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="GitHub" src="_static/images/github_button.png"/></a>
&nbsp;<a href="https://stackoverflow.com/questions/tagged/hyperledger-fabric"><img style="padding: 0px; margin: auto auto auto auto;" alt="StackOverflow" src="_static/images/stackoverflow_button.png"/></a>
&nbsp;<a href="https://chat.hyperledger.org"><img style="padding: 0px; margin: auto auto auto auto;" alt="Rocket Chat" src="_static/images/rocketchat_button.png"/></a>
&nbsp;<a href="https://www.youtube.com/playlist?list=PL0MZ85B_96CH7wvtrRzV7SvtRY0sI0DEg"><img style="padding: 0px; margin: auto auto auto auto;" alt="Youtube Channel" src="_static/images/youtube_button.png"/></a>

        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatis.html">Introdução</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What’s new in Hyperledger Fabric v2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html#release-notes">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html">Conceitos Chave</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="developapps/developing_applications.html">Developing Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="deployment_guide_overview.html">Deploying a production network</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="ops_guide.html">Operations Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="orderer_deploy.html">Setting up an ordering node</a></li>
<li class="toctree-l2"><a class="reference internal" href="msp.html">Membership Service Providers (MSP)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using a Hardware Security Module (HSM)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-an-hsm">Configuring an HSM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-a-network-using-hsm">Setting up a network using HSM</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#before-you-begin">Before you begin</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-an-hsm-with-a-fabric-ca">Using an HSM with a Fabric CA</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-an-hsm-with-your-own-ca">Using an HSM with your own CA</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configtx.html">Channel Configuration (configtx)</a></li>
<li class="toctree-l2"><a class="reference internal" href="endorsement-policies.html">Endorsement policies</a></li>
<li class="toctree-l2"><a class="reference internal" href="pluggable_endorsement_and_validation.html">Pluggable transaction endorsement and validation</a></li>
<li class="toctree-l2"><a class="reference internal" href="access_control.html">Access Control Lists (ACL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="idemix.html">MSP Implementation with Identity Mixer</a></li>
<li class="toctree-l2"><a class="reference internal" href="idemixgen.html">Identity Mixer MSP configuration generator (idemixgen)</a></li>
<li class="toctree-l2"><a class="reference internal" href="operations_service.html">The Operations Service</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics_reference.html">Metrics Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="cc_launcher.html">External Builders and Launchers</a></li>
<li class="toctree-l2"><a class="reference internal" href="cc_service.html">Chaincode as an external service</a></li>
<li class="toctree-l2"><a class="reference internal" href="error-handling.html">Error handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging-control.html">Logging Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="enable_tls.html">Securing Communication With Transport Layer Security (TLS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="raft_configuration.html">Configuring and operating a Raft ordering service</a></li>
<li class="toctree-l2"><a class="reference internal" href="kafka_raft_migration.html">Migrating from Kafka to Raft</a></li>
<li class="toctree-l2"><a class="reference internal" href="kafka.html">Bringing up a Kafka-based Ordering Service</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrading to the latest release</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_ref.html">Commands Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="Fabric-FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="CONTRIBUTING.html">Contributions Welcome!</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="questions.html">Still Have Questions?</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">hyperledger-fabricdocs</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="ops_guide.html">Operations Guides</a> &raquo;</li>
        
      <li>Using a Hardware Security Module (HSM)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/hsm.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using-a-hardware-security-module-hsm">
<span id="using-a-hardware-security-module-hsm"></span><h1>Using a Hardware Security Module (HSM)<a class="headerlink" href="#using-a-hardware-security-module-hsm" title="Permalink to this headline">¶</a></h1>
<p>The cryptographic operations performed by Fabric nodes can be delegated to
a Hardware Security Module (HSM).  An HSM protects your private keys and
handles cryptographic operations, allowing your peers and orderer nodes to
sign and endorse transactions without exposing their private keys.  If you
require compliance with government standards such as FIPS 140-2, there are
multiple certified HSMs from which to choose.</p>
<p>Fabric currently leverages the PKCS11 standard to communicate with an HSM.</p>
<div class="section" id="configuring-an-hsm">
<span id="configuring-an-hsm"></span><h2>Configuring an HSM<a class="headerlink" href="#configuring-an-hsm" title="Permalink to this headline">¶</a></h2>
<p>To use an HSM with your Fabric node, you need to update the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> (Crypto Service
Provider) section of the node configuration file such as core.yaml or
orderer.yaml. In the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section, you need to select PKCS11 as the provider and
enter the path to the PKCS11 library that you would like to use. You also need
to provide the <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code> of the token that you created for your cryptographic
operations. You can use one token to generate and store multiple keys.</p>
<p>The prebuilt Hyperledger Fabric Docker images are not enabled to use PKCS11. If
you are deploying Fabric using docker, you need to build your own images and
enable PKCS11 using the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">docker</span> <span class="n">GO_TAGS</span><span class="o">=</span><span class="n">pkcs11</span>
</pre></div>
</div>
<p>You also need to ensure that the PKCS11 library is available to be used by the
node by installing it or mounting it inside the container.</p>
<div class="section" id="example">
<span id="example"></span><h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>The following example demonstrates how to configure a Fabric node to use an HSM.</p>
<p>First, you will need to install an implementation of the PKCS11 interface. This
example uses the <a class="reference external" href="https://github.com/opendnssec/SoftHSMv2">softhsm</a> open source
implementation. After downloading and configuring softhsm, you will need to set
the SOFTHSM2_CONF environment variable to point to the softhsm2 configuration
file.</p>
<p>You can then use softhsm to create the token that will handle the cryptographic
operations of your Fabric node inside an HSM slot. In this example, we create a
token labelled “fabric” and set the pin to “71811222”. After you have created
the token, update the configuration file to use PKCS11 and your token as the
crypto service provider. You can find an example <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#############################################################################</span>
<span class="c1"># BCCSP (BlockChain Crypto Service Provider) section is used to select which</span>
<span class="c1"># crypto library implementation to use</span>
<span class="c1">#############################################################################</span>
<span class="n">bccsp</span><span class="p">:</span>
  <span class="n">default</span><span class="p">:</span> <span class="n">PKCS11</span>
  <span class="n">pkcs11</span><span class="p">:</span>
    <span class="n">Library</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
    <span class="n">Pin</span><span class="p">:</span> <span class="mi">71811222</span>
    <span class="n">Label</span><span class="p">:</span> <span class="n">fabric</span>
    <span class="nb">hash</span><span class="p">:</span> <span class="n">SHA2</span>
    <span class="n">security</span><span class="p">:</span> <span class="mi">256</span>
    <span class="n">Immutable</span><span class="p">:</span> <span class="n">false</span>
</pre></div>
</div>
<p>By default, when private keys are generated using the HSM, the private key is mutable, meaning PKCS11 private key  attributes can be changed after the key is generated. Setting <code class="docutils literal notranslate"><span class="pre">Immutable</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code> means that the private key attributes cannot be altered after key generation. Before you configure immutability by setting <code class="docutils literal notranslate"><span class="pre">Immutable:</span> <span class="pre">true</span></code>, ensure that PKCS11 object copy is supported by the HSM.</p>
<p>You can also use environment variables to override the relevant fields of the configuration file. If you are connecting to softhsm2 using the Fabric CA server, you could set the following environment variables or directly set the corresponding values in the CA server config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FABRIC_CA_SERVER_BCCSP_DEFAULT</span><span class="o">=</span><span class="n">PKCS11</span>
<span class="n">FABRIC_CA_SERVER_BCCSP_PKCS11_LIBRARY</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
<span class="n">FABRIC_CA_SERVER_BCCSP_PKCS11_PIN</span><span class="o">=</span><span class="mi">71811222</span>
<span class="n">FABRIC_CA_SERVER_BCCSP_PKCS11_LABEL</span><span class="o">=</span><span class="n">fabric</span>
</pre></div>
</div>
<p>If you are connecting to softhsm2 using the Fabric peer, you could set the following environment variables or directly set the corresponding values in the peer config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CORE_PEER_BCCSP_DEFAULT</span><span class="o">=</span><span class="n">PKCS11</span>
<span class="n">CORE_PEER_BCCSP_PKCS11_LIBRARY</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
<span class="n">CORE_PEER_BCCSP_PKCS11_PIN</span><span class="o">=</span><span class="mi">71811222</span>
<span class="n">CORE_PEER_BCCSP_PKCS11_LABEL</span><span class="o">=</span><span class="n">fabric</span>
</pre></div>
</div>
<p>If you are connecting to softhsm2 using the Fabric orderer, you could set the following environment variables or directly set the corresponding values in the orderer config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ORDERER_GENERAL_BCCSP_DEFAULT</span><span class="o">=</span><span class="n">PKCS11</span>
<span class="n">ORDERER_GENERAL_BCCSP_PKCS11_LIBRARY</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
<span class="n">ORDERER_GENERAL_BCCSP_PKCS11_PIN</span><span class="o">=</span><span class="mi">71811222</span>
<span class="n">ORDERER_GENERAL_BCCSP_PKCS11_LABEL</span><span class="o">=</span><span class="n">fabric</span>
</pre></div>
</div>
<p>If you are deploying your nodes using docker compose, after building your own
images, you can update your docker compose files to mount the softhsm library
and configuration file inside the container using volumes. As an example, you
would add the following environment and volumes variables to your docker compose
file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">environment</span><span class="p">:</span>
     <span class="o">-</span> <span class="n">SOFTHSM2_CONF</span><span class="o">=/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">file</span>
  <span class="n">volumes</span><span class="p">:</span>
     <span class="o">-</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">softhsm</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">file</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">file</span>
     <span class="o">-</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">Cellar</span><span class="o">/</span><span class="n">softhsm</span><span class="o">/</span><span class="mf">2.1</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">softhsm</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span><span class="p">:</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="setting-up-a-network-using-hsm">
<span id="setting-up-a-network-using-hsm"></span><h2>Setting up a network using HSM<a class="headerlink" href="#setting-up-a-network-using-hsm" title="Permalink to this headline">¶</a></h2>
<p>If you are deploying Fabric nodes using an HSM, your private keys need to be
generated and stored inside the HSM rather than inside the <code class="docutils literal notranslate"><span class="pre">keystore</span></code> folder of the node’s
local MSP folder. The <code class="docutils literal notranslate"><span class="pre">keystore</span></code> folder of the MSP will remain empty. Instead,
the Fabric node will use the subject key identifier of the signing certificate
in the <code class="docutils literal notranslate"><span class="pre">signcerts</span></code> folder to retrieve the private key from inside the HSM.
The process for creating the node MSP folder differs depending on whether you
are using a Fabric Certificate Authority (CA) your own CA.</p>
<div class="section" id="before-you-begin">
<span id="before-you-begin"></span><h3>Before you begin<a class="headerlink" href="#before-you-begin" title="Permalink to this headline">¶</a></h3>
<p>Before configuring a Fabric node to use an HSM, you should have completed the following steps:</p>
<ol class="simple">
<li>Created a partition on your HSM Server and recorded the <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code> of the partition.</li>
<li>Followed instructions in the documentation from your HSM provider to configure an HSM Client that communicates with your HSM server.</li>
</ol>
</div>
<div class="section" id="using-an-hsm-with-a-fabric-ca">
<span id="using-an-hsm-with-a-fabric-ca"></span><h3>Using an HSM with a Fabric CA<a class="headerlink" href="#using-an-hsm-with-a-fabric-ca" title="Permalink to this headline">¶</a></h3>
<p>You can set up a Fabric CA to use an HSM by making the same edits to the CA server configuration file as you would make to a peer or ordering node. Because you can use the Fabric CA to generate keys inside an HSM, the process of creating the local MSP folders is straightforward. Use the following steps:</p>
<ol class="simple">
<li>Modify the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section of the Fabric CA server configuration file and point to the <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code> that you created for your HSM. When the Fabric CA server starts, the private key is generated and stored in the HSM. If you are not concerned about exposing your CA signing certificate, you can skip this step and only configure an HSM for your peer or ordering nodes, described in the next steps.</li>
<li>Use the Fabric CA client to register the peer or ordering node identities with your CA.</li>
<li>Before you deploy a peer or ordering node with HSM support, you need to enroll the node identity by storing its private key in the HSM. Edit the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section of the Fabric CA client config file or use the associated environment variables to point to the HSM configuration for your peer or ordering node. In the Fabric CA Client configuration file, replace the default <code class="docutils literal notranslate"><span class="pre">SW</span></code> configuration with the <code class="docutils literal notranslate"><span class="pre">PKCS11</span></code> configuration and provide the values for your own HSM:</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bccsp</span><span class="p">:</span>
  <span class="n">default</span><span class="p">:</span> <span class="n">PKCS11</span>
  <span class="n">pkcs11</span><span class="p">:</span>
    <span class="n">Library</span><span class="p">:</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">hyperledger</span><span class="o">/</span><span class="n">fabric</span><span class="o">/</span><span class="n">libsofthsm2</span><span class="o">.</span><span class="n">so</span>
    <span class="n">Pin</span><span class="p">:</span> <span class="mi">71811222</span>
    <span class="n">Label</span><span class="p">:</span> <span class="n">fabric</span>
    <span class="nb">hash</span><span class="p">:</span> <span class="n">SHA2</span>
    <span class="n">security</span><span class="p">:</span> <span class="mi">256</span>
    <span class="n">Immutable</span><span class="p">:</span> <span class="n">false</span>
</pre></div>
</div>
<p>Then for each node, use the Fabric CA client to generate the peer or ordering node’s MSP folder by enrolling against the node identity that you registered in step 2. Instead of storing the private key in the <code class="docutils literal notranslate"><span class="pre">keystore</span></code> folder of the associated MSP, the enroll command uses the node’s HSM to generate and store the private key for the peer or ordering node. The <code class="docutils literal notranslate"><span class="pre">keystore</span></code> folder remains empty.</p>
<ol class="simple">
<li>To configure a peer or ordering node to use the HSM, similarly update the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section of the peer or orderer configuration file to use PKCS11 and provide the <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code>. Also, edit the value of the <code class="docutils literal notranslate"><span class="pre">mspConfigPath</span></code> (for a peer node) or the <code class="docutils literal notranslate"><span class="pre">LocalMSPDir</span></code> (for an ordering node) to point to the MSP folder that was generated in the previous step using the Fabric CA client. Now that the peer or ordering node is configured to use HSM, when you start the node it will be able sign and endorse transactions with the private key protected by the HSM.</li>
</ol>
</div>
<div class="section" id="using-an-hsm-with-your-own-ca">
<span id="using-an-hsm-with-your-own-ca"></span><h3>Using an HSM with your own CA<a class="headerlink" href="#using-an-hsm-with-your-own-ca" title="Permalink to this headline">¶</a></h3>
<p>If you are using your own Certificate Authority to deploy Fabric components, you
can use an HSM using the following steps:</p>
<ol class="simple">
<li>Configure your CA to communicate with an HSM using PKCS11 and create a <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code>.
Then use your CA to generate the private key and signing certificate for each
node, with the private key generated inside the HSM.</li>
<li>Use your CA to build the peer or ordering node MSP folder. Place the signing certificate that you generated in step 1 inside the <code class="docutils literal notranslate"><span class="pre">signcerts</span></code> folder. You can leave the <code class="docutils literal notranslate"><span class="pre">keystore</span></code> folder empty.</li>
<li>To configure a peer or ordering node to use the HSM, similarly update the <code class="docutils literal notranslate"><span class="pre">bccsp</span></code> section of the peer or orderer configuration file to use PKCS11 andand provide the <code class="docutils literal notranslate"><span class="pre">Label</span></code> and <code class="docutils literal notranslate"><span class="pre">PIN</span></code>. Edit the value of the <code class="docutils literal notranslate"><span class="pre">mspConfigPath</span></code> (for a peer node) or the <code class="docutils literal notranslate"><span class="pre">LocalMSPDir</span></code> (for an ordering node) to point to the MSP folder that was generated in the previous step using the Fabric CA client. Now that the peer or ordering node is configured to use HSM, when you start the node it will be able sign and endorse transactions with the private key protected by the HSM.</li>
</ol>
<!--- Licensed under Creative Commons Attribution 4.0 International License
https://creativecommons.org/licenses/by/4.0/ --></div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configtx.html" class="btn btn-neutral float-right" title="Channel Configuration (configtx)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="msp.html" class="btn btn-neutral" title="Membership Service Providers (MSP)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Hyperledger 2020.
    <br>
      <br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
      <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'master',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>